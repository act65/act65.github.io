---
layout: post
title: Calculating the mean
---

I thought averages were simple. But I've recently disocvered that;

$$
\mathcal L(\theta) = \sum_{i} \parallel y_i - f(x_i; \theta) \parallel^2
$$

But what if we replace the neural network, $f(x_i)$, with a constant?

$$
\mathcal L(\theta) = \sum_{i} \parallel y_i - \theta \parallel^2
$$

Don't be fooled by the simplicity of this idea. There is a lot to it.
We have traded accuracy for understandability.


<!-- start with a puzzle? -->
<!-- What is the mean-ing of life? -->

I thought means, medians and modes were simple. I was wrong.

I recently discovered that;

- the arithmetic mean is one of many means. It is not always the 'right' mean to use.
- there is more than one algorithm for calculating the arithmetic mean. The 'usual' algorithm (sum and divide by N) is not the 'best' algorithm.
- the mode, the highest probability point, is not always representative of the data.
- The arithmetic mean is not always the best way to summarise data.
- the mean may be very unusual (when compared to typical samples)
- the 'usual' algorithm (sum and divide by N) for calculating the arithmetic mean is not the 'best' algorithm.

Let's explore these ideas in more detail.

## 'Typical' samples


## Summarising data

### Mean, median, mode

The mean is not robust to outliers.
For example, if we have a dataset of 1000 numbers, and 999 of them are 0, and 1 of them is 100,000, then the mean is 100. But this is not a good summary of the data. 
In this case, the median is a better summary.


### Which mean should we use? And when?

There are many formal definitions of an average.
Which is the 'right' definiton? Well, that depends on what you want to do with it.

#### The arithmetic mean

$$
A(a) = \frac{1}{N}\sum a_i
$$

Properties
- the numbers to the left of the mean are balanced by the numbers to the right. The mean is the only number for which the residuals (deviations from the estimate) sum to zero
- Translation and scale invariant. A(a+x) = A + x. A(ax) = aA.
- monotonocity. $A(a) > A(b)$ if $a > b$
- invariance under exchange. $A(a,b) = A(b,a)$

> Notice, what we are essentially saying here is: if every number in our dataset was the same number, what number would it have to be in order to have the same sum as our actual dataset?

#### The geometric mean

$$
G(a) = \bigg(\prod a_i \bigg)^{\frac{1}{N}}
$$

Properties
- 


Equivalently, as the arithmetic mean in logscale:

$$
\exp{\left(\frac {1}{n}}\sum \ln a_{i}\right)
$$

When would we want to use this? When the elements of a combine ???-ly.
For example, what is the average of a 2x, a 3x, and a 13x speed up?

> The geometric mean can be understood in terms of geometry. The geometric mean of two numbers, a and b, is the length of one side of a square whose area is equal to the area of a rectangle with sides of lengths a and b. Similarly, the geometric mean of three numbers, a a, b b, and c c, is the length of one edge of a cube whose volume is the same as that of a cuboid with sides whose lengths are equal to the three given numbers. 

Ie we are summarising ... the data by the volume of a hypercube.

#### The harmonic mean

$$
H(a) = \bigg( \frac{\sum a_i^{-1}}{n} \bigg)^{-1}
$$

> it tends (compared to the arithmetic mean) to mitigate the impact of large outliers and aggravate the impact of small ones.

use case: rates. average speed.

## The best algorithm for calculating the arithmetic mean

Let's dig deeper into calculating the arithmetic mean. What do we mean by best?

- most accurate / robust?
- most efficient?

### Robust algorithms for calculating averages

As argued above, the mean is not robust to outliers.

Mean of medians. vs median of means.

Near-optimal mean estimators with respect to general norms

What about online mean estimation? How to use mean of medians?

What about a tree of medians? Say n = 3. Then take the median of the first 3 numbers and add that as a parent and forget the original 3.  

https://arxiv.org/abs/1806.06233

Variance reduction?


### Efficient algorithms for calculating averages

Reduce all.
Gossip.


***

Related reading and references

Wiki! 
- [Central tendency](https://en.wikipedia.org/wiki/Central_tendency)
- [Arithmetic mean](https://en.wikipedia.org/wiki/Arithmetic_mean), [Geometric mean](https://en.wikipedia.org/wiki/Geometric_mean), [Harmonic mean](https://en.wikipedia.org/wiki/Harmonic_mean)


<!-- max likelihood / max a posteriori take the max of a distribution. ie the mode? -->

<aside>
## Optimal solutions

Averages as minimisers of cost functions.
Mean, median and mode.

The mean is the minimiser of the squared error.
$$
\mathop{\text{argmin}}_x \sum_i (x - x_i)^2
$$

The median is the minimiser of the absolute error.
$$
\mathop{\text{argmin}}_x \sum_i (x - x_i)^1
$$


The mode is the minimiser of the 0th power error.
$$
\mathop{\text{argmin}}_x \sum_i (x - x_i)^0
$$

***

(no. only for 2 numbers in the data)
$$
A(a)H(a) = G(a)^2
$$


Questions
- Do there exist variational fns whose minima are the geometric and harmonic means??
- What is the geometric / harmonic mean of a set of numbers that are not all positive? Generalise to complex numbers?
- 

</aside>

_This is an example on the depths of math. Nothing is as simple as you think. Except for the things that are._
